<!DOCTYPE html>
<html lang="en">

<%- include('includes/head', {title: 'Home | CD Shop'}) %>

<!-- allow attached Javascript to read publicAudioUrl variable: -->
<script>
    window.publicAudioUrl = '<%= publicAudioUrl %>';
</script>
<script src="/assets/js/show-audio-player-when-audiofile-defined.mjs" type="module" defer 
></script>

<body>
    <%- include('includes/header') %>
    <main>
        <section>
            <p>
                Welcome to this CD shop website, which doubles as a music file uploading/playback website.
            </p>
            <p>
                We currently have <%= numberOfCDsInStock %> CDs in stock.
            </p>
            <p>
                We have sold <%= numberOfCDsSold %> CDs.
            </p>
            <br>
        </section>
        <% if (req.isAuthenticated()) { %>
        <section>
            <h2>Admin-only Section:</h2>
            <p>
                You can try this secret route: /assets/react.html. 
            </p>    
            <p>
                These routes work as POST requests (e.g. with Postman), using a jwt-based login system which is a work-in-progress, but they are not yet accessible in the UI: /api/users, /api/login. (Instead of that jwt system, a non-jwt system currently handles user creation and login at these routes: /add-user and /login.) Referencing the source code would be necessary, to know what values to put into these requests.
            </p>
            <form action ="/add-user" method="POST">
                <h3>Create new admin user</h3>
                <input type="text" name="username" placeholder="username" /><br/>
                <input type="password" name="password" placeholder="password" /> <br/>
                <button>Create</button>
            </form>
            <br />
        </section>
        <% } %>
        <section>
            <h2>Audio Upload/Player Options</h2>
            <form action="/upload2" method="POST" enctype="multipart/form-data">
                <h3> Upload audio to Google Cloud:</h3>
                <input type="file" name="audiofile.mp3" accept=".mp3" placeholder="Audio file to upload"/>
                <button>Upload</button>
            </form>
            <form action="/upload" method="POST" enctype="multipart/form-data">
                <h3> Upload audio to local storage (only works when locally hosting): </h3>
                <input type="file" name="file" placeholder="File to upload"/>
                <button>Upload</button>
            </form>
            <div id="audio-player">
                <h3>Play the audio you uploaded to Google Cloud:</h3>
                <audio controls src="<%= publicAudioUrl %>" type="audio"></audio>
            </div>
        </section>
    </main>

    <%- include('includes/footer') %>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>

</html>